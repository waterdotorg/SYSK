name: Simple Keep-Alive
on:
  schedule:
    # Run every 4 hours (6 times per day)
    - cron: '0 */4 * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wake Up App
        run: |
          echo "‚è∞ Keep-alive triggered at $(date -u)"
          
          # Replace with your actual Streamlit app URL
          APP_URL="https://water-portal-assistant.streamlit.app"
          
          # Make multiple requests to ensure app wakes and stays awake
          for i in {1..3}; do
            echo "Request $i of 3..."
            
            # Full page load with proper headers
            curl -sL "$APP_URL" \
              -A "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
              -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
              -H "Accept-Language: en-US,en;q=0.9" \
              -H "Accept-Encoding: gzip, deflate, br" \
              -H "Connection: keep-alive" \
              --compressed \
              --max-time 45 \
              > /dev/null
            
            if [ $? -eq 0 ]; then
              echo "  ‚úÖ Success"
            else
              echo "  ‚ùå Failed"
            fi
            
            # Wait between requests
            if [ $i -lt 3 ]; then
              sleep 10
            fi
          done
          
          echo "‚ú® Keep-alive completed"
          echo "üìÖ Next run: $(date -u -d '+4 hours' '+%Y-%m-%d %H:%M:%S UTC')"

      - name: Health Check
        run: |
          APP_URL="https://water-portal-assistant.streamlit.app"
          
          # Check Streamlit health endpoint
          HTTP_CODE=$(curl -sL -w "%{http_code}" "$APP_URL/_stcore/health" -o /dev/null)
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "üü¢ App is healthy (HTTP $HTTP_CODE)"
          else
            echo "üî¥ App returned HTTP $HTTP_CODE"
          fi
