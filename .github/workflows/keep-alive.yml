name: Keep Streamlit App Alive

on:
  schedule:
    # Every 2 hours
    - cron: "0 */1 * * *"
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest

    steps:
      - name: Wake Streamlit runtime
        run: |
          echo "Waking Streamlit app..."

          curl -L \
            -A "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
            -H "Accept-Language: en-US,en;q=0.5" \
            -H "Cache-Control: no-cache" \
            -H "Pragma: no-cache" \
            --max-time 60 \
            https://syskchat.streamlit.app/?keepalive=true

      - name: Touch Streamlit health endpoint
        run: |
          curl -s --max-time 30 https://syskchat.streamlit.app/_stcore/health || true

      - name: Log timestamp
        run: |
          echo "Keep-alive completed at $(date -u)"
